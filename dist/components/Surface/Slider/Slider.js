"use client";import{jsx as e,jsxs as r}from"react/jsx-runtime";import{Children as t,Fragment as l,useCallback as n,useEffect as a,useMemo as i,useRef as s,useState as o}from"react";import{FaAngleLeft as c}from"react-icons/fa6";import{twMerge as m}from"tailwind-merge";import{Pagination as u}from"../../Pagination/Pagination/Pagination.js";import{SliderArrow as g}from"./SliderArrow.js";import{range as d}from"../../../services/ArrayService.js";import{Timer as p}from"../../../services/classes/Timer.js";import{useImmediateRef as v}from"../../../services/hooks/useImmediateRef.js";import{clamp as h}from"../../../services/NumberService.js";import{normalizeBreakpoints as f}from"../../../services/ResponsiveService.js";export function Slider({duration:x=5e3,items:w=1,gap:N=.5,infinity:b=!0,stretch:A=!0,centered:M=!0,swipe:E=!0,className:j,arrowsIcon:y=e(c,{}),arrowsStepMode:P="sequential",arrowsClassName:C,arrowsPlacement:S="overlay",arrowsPlacementFallback:T="overlay",pagination:q="after",paginationClassName:F,paginationCompressed:I=!0,paginationLimit:W,children:L=[]}){let[R,_]=o(0),[k,z]=o(null),[X,D]=o(0),G=i(()=>t.toArray(L),[L]),U=i(()=>f("--cols-",w,1,A?G.length:Number.MAX_VALUE),[A,w,G.length]),O=i(()=>f("--gap-",N,0),[N]),[V,$]=o(1),B=i(()=>G.length>V,[G.length,V]),H=i(()=>[...b&&B?G.slice(-V):[],...G,...b&&B?G.slice(0,2*V-1):d(0,2*V-1).map(r=>e("div",{},`${r}-after`))],[b,B,G,V]),J=s(null),K=s(null),Q=s(null),[Y,Z]=o(!1);a(()=>{let e=new ResizeObserver(([e])=>{$(Number(e.target.computedStyleMap().get("--cols")[0]))});function r(){let e=Q.current?.offsetWidth??0;Z(null!==J.current&&J.current.offsetWidth+2*e<=document.body.offsetWidth-40)}return null!==K.current&&e.observe(K.current),addEventListener("resize",r),requestAnimationFrame(()=>{r()}),()=>{e.disconnect(),removeEventListener("resize",r)}},[]);let[ee,er]=o(!0),et=n(e=>{if(!B)return;let r=h("sequential"===P?R+e:R+V*e,b?Number.MIN_SAFE_INTEGER:0,b?Number.MAX_SAFE_INTEGER:G.length-V);r<0?(er(!1),_(G.length),requestAnimationFrame(()=>{er(!0),_(G.length+r)})):!b&&r>=G.length-(V-1)?_(0):_(r)},[P,R,b,B,G.length,V]),el=v(et),en=n(()=>{er(!1),requestAnimationFrame(()=>{_(e=>e>=G.length?e-G.length:e),requestAnimationFrame(()=>{er(!0)})})},[G.length]),ea=i(()=>B?Y||"external"!==S?S:T:"disabled",[B,S,T,Y]),ei=i(()=>M?-Math.max(0,(V-G.length)/2):0,[M,G.length,V]),es=i(()=>I?Math.ceil(G.length/V):G.length,[I,G.length,V]);a(()=>{B||_(0)},[B]);let eo=s(null),ec=v(k);a(()=>(eo.current?.stop(),eo.current=new p(()=>{null===ec.current&&el.current(1)},x),()=>{eo.current?.stop()}),[x,el,ec]);let em=i(()=>E&&B,[B,E]),eu=n(e=>{em&&z(e.clientX)},[em]),eg=n(e=>{em&&null!==k&&(D(h(k-e.clientX,-e.currentTarget.offsetWidth,e.currentTarget.offsetWidth)),e.currentTarget.setPointerCapture(e.pointerId))},[em,k]),ed=n(e=>{if(em){let r=e.currentTarget;z(null),requestAnimationFrame(()=>{D(e=>(el.current(Math.round(e/(r.offsetWidth/V))),0))}),r.releasePointerCapture(e.pointerId)}},[el,em,V]),ep=i(()=>I?es>1:B,[B,I,es]);return 0===G.length?null:r("div",{className:m("relative flex flex-col gap-y-2 select-none",j),ref:J,onMouseLeave:()=>{eo.current?.start()},onMouseEnter:()=>{eo.current?.stop()},children:[r("div",{className:"bg-theme-100 relative flex",children:[e(g,{ref:Q,icon:y,className:C,placement:ea,isDisabled:!b&&0===R,onClick:()=>{et(-1)}}),e("div",{className:"flex-auto touch-none overflow-x-hidden",onPointerDown:eu,onPointerMove:eg,onPointerUp:ed,onPointerCancel:ed,children:e("div",{ref:K,className:m("grid w-full auto-cols-(--width) grid-flow-col gap-x-[calc(1rem*var(--gap))]","[--cols:var(--cols-xs)] sm:[--cols:var(--cols-sm)] md:[--cols:var(--cols-md)] lg:[--cols:var(--cols-lg)] xl:[--cols:var(--cols-xl)] 2xl:[--cols:var(--cols-2xl)]","[--gap:var(--gap-xs)] sm:[--gap:var(--gap-sm)] md:[--gap:var(--gap-md)] lg:[--gap:var(--gap-lg)] xl:[--gap:var(--gap-xl)] 2xl:[--gap:var(--gap-2xl)]","[--gap-width:calc(1rem*var(--gap))] [--width:calc((100%-(var(--gap-width))*(var(--cols)-1))/var(--cols))]","-translate-x-[calc(var(--index)*(var(--width)+var(--gap-width))+var(--swipe)*1px)]",ee&&null===k&&"transition-[translate]"),style:{...U,...O,"--index":ei+R+(b&&B?V:0),"--swipe":X},onTransitionEnd:en,children:H.map((r,t)=>e(l,{children:r},t))})}),e(g,{icon:y,className:C,placement:ea,rotate:!0,isDisabled:!b&&R===G.length-V,onClick:()=>{et(1)}})]}),ep&&e("div",{className:m(!1===q&&"hidden","overlay"===q&&"absolute inset-x-0 bottom-2",F),children:e(u,{current:I?R===G.length-V?es:Math.ceil((R+1)/V):R+1,total:es,visibleCount:W,spread:I?void 0:V-1,pageClassName:"text-[size:0] w-2.5",firstLast:!1,previousNext:!1,onClick:e=>{_(I?Math.min((e-1)*V,G.length-V):e-1)}})})]})}